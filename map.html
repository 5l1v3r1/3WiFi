<title>3WiFi: Карта точек доступа</title>

<head>
<script src="//api-maps.yandex.ru/2.1/?lang=ru-RU" type="text/javascript"></script>
<script src="FileSaver.min.js" type="text/javascript"></script>
<script type="text/javascript">
function initmap()
{
	myMap = new ymaps.Map('map', {
		center: [%var_lat%, %var_lon%],
		zoom: 18,
		controls: ['geolocationControl','searchControl','typeSelector','fullscreenControl','zoomControl']
	}),

	remoteObjectManager = new ymaps.RemoteObjectManager('3wifi.php?a=map&tileNumber=%t&zoom=%z',
	{	// Разбивать запросы по тайлам
		splitRequests: false,
		// Опции кластеров задаются с префиксом cluster.
		clusterHasBalloon: false,
		clusterHasHint: true,
		// Опции объектов задаются с префиксом geoObject
		geoObjectOpenBalloonOnClick: false
	});

	myMap.geoObjects.add(remoteObjectManager);

	// Кнопка скрытия/показа точек доступа
	var iconShowAP = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogPGc+CiAgPHRpdGxlPkxheWVyIDE8L3RpdGxlPgogIDxwYXRoIGlkPSJzdmdfMSIgZD0ibS02MTIsMzIwbDAsOTZsOTYsMGwwLC05NmwtOTYsMHptODMsODNsLTcwLDBsMCwtNzBsNzAsMGwwLDcweiIvPgogIDxwYXRoIGlkPSJzdmdfMiIgZD0ibTcuMzQwNDQ2LDIuNzU5NjM4YzIuODczNTkyLC0wLjIwNjk1MSA1LjgxMzcxNiwwLjg2ODE4NSA3Ljg2NDYyNCwyLjg5MzEyNGMwLjI2ODczLDAuMjc2NjQgMC4yMzM2ODYsMC43NjA1NzEgLTAuMDQ5ODIzLDEuMDE0MDkyYy0wLjI2MDM5MiwwLjMwNjk2NCAtMC43ODE4NDcsMC4zMTIzOSAtMS4wNTA1NzksMC4wMTMzNjljLTEuNzU0NDYsLTEuNjg5MDYzIC00LjIzMTU2MywtMi42MDI0MDkgLTYuNjYzODQzLC0yLjQyMDc1M2MtMi4wMjA2MTUsMC4xMjk5OTcgLTMuOTc4MDQxLDEuMDAwMzU5IC01LjQ0NDI3MiwyLjM5NDM4NmMtMC4xMzAzOTUsMC4xMzMyNzYgLTAuMjk2OTA2LDAuMjQyNzAxIC0wLjQ4ODY1MSwwLjI1MjA4MWMtMC40ODAzMTEsMC4wNTYzMjMgLTAuOTI0NTA2LC0wLjQ0NTY2NCAtMC44MjA4NDYsLTAuOTE1NDkyYzAuMDI5MjQ5LC0wLjE2ODY1OCAwLjEzNzU2OSwtMC4zMDkxMzkgMC4yNjE0MzQsLTAuNDIxNDc2YzEuNzE2NTY0LC0xLjY0MzU2NCA0LjAyMTAyNCwtMi42NTI5NjcgNi4zOTE5NTYsLTIuODA5MzMxeiIgZmlsbD0iIzAwMDAwMCIvPgogIDxwYXRoIHN0cm9rZT0ibnVsbCIgaWQ9InN2Z18zIiBkPSJtNy4yNjkzMTYsNS41Nzc2NDVjMi4yMDE1MzgsLTAuMjM5NDUxIDQuNDg3NiwwLjU3MjA0NiA2LjA0NTUzMywyLjE0NTE4NmMwLjI0MzQwNCwwLjI3ODA4MiAwLjIxMzA4NCwwLjczMjc5MyAtMC4wNTczOTQsMC45ODI2OThjLTAuMjQ2Njg3LDAuMzAxOTAzIC0wLjc0Mzk1MywwLjMzNTgxMiAtMS4wMjM1MDcsMC4wNjIwNTRjLTAuOTk3NDc3LC0wLjk4MzM3NSAtMi4zNDYwMDQsLTEuNjA3Nzg0IC0zLjc0NDMyNCwtMS43MTAwMDRjLTEuNjk4MTM2LC0wLjE0MDg0OSAtMy40MzMwNjYsMC41MDM0MjkgLTQuNjQyMTg2LDEuNjk5OTE4Yy0wLjI3ODgxNiwwLjI5NDY5OSAtMC43OTgxNTgsMC4yNjExNTcgLTEuMDQ5MTA2LC0wLjA1MjM2NmMtMC4yNzA1MDksLTAuMjU1MzAyIC0wLjI5Mjg5MSwtMC43MjIzMDggLTAuMDMzMjM1LC0wLjk5Mjc4N2MxLjE5ODI5NywtMS4xOTg5NyAyLjgxODc0MywtMS45NjE3MTcgNC41MDQyMTksLTIuMTM0Njk4eiIgZmlsbD0iIzAwMDAwMCIvPgogIDxwYXRoIHN0cm9rZT0ibnVsbCIgaWQ9InN2Z180IiBkPSJtNy41OTQ3MDYsOC4zNTgwOTRjMS4zODkzMDMsLTAuMTM3OTM4IDIuODI1NjEsMC4zOTQwMzcgMy43OTIzNjYsMS40MDAxODhjMC4yNjQ3MTQsMC4yNzU1MzggMC4yMzQwNTQsMC43NDk3NDggLTAuMDQ0NzkzLDEuMDA0NzEzYy0wLjI1MzE1NiwwLjMwNTU1MiAtMC43NjA1NzEsMC4zMjYxNTYgLTEuMDM1NzQsMC4wMzk3MzRjLTAuNTQ0OTQzLC0wLjU1OTM4MSAtMS4yOTk3ODEsLTAuOTEyOTc3IC0yLjA4MTI5MiwtMC45NTU1OTRjLTAuODg2OTQ3LC0wLjA2MzIyIC0xLjc4NDQxMiwwLjI4NzEyNSAtMi40MTQyNTEsMC45MTA0MzNjLTAuMTU0OTIyLDAuMTc0MTE2IC0wLjM4NDk5LDAuMjgwOTk0IC0wLjYyMDQ1NiwwLjI1MzIxN2MtMC41NDY3NTEsLTAuMDM4MzIzIC0wLjkyNjMxNSwtMC43NjgyMDMgLTAuNTQ5NjYzLC0xLjIwNjI2N2MwLjc2MDU3LC0wLjgyNDg2MiAxLjg0MDc2NiwtMS4zMzU4OTUgMi45NTM4MjksLTEuNDQ2NDI0eiIgZmlsbD0iIzAwMDAwMCIvPgogIDxwYXRoIHN0cm9rZT0ibnVsbCIgaWQ9InN2Z181IiBkPSJtNy44MDg4NjIsMTAuOTU0MzcxYzAuODk1Mjg3LC0wLjE1MDIyOSAxLjgwMzkxMiwwLjU4OTA2NSAxLjgzMjgyNCwxLjQ5NjkyMmMwLjA4MzA1NiwwLjg5MDIyNyAtMC43MDI4MDcsMS43MzQ5OSAtMS41OTYyMjYsMS43MTU0MjljLTAuODAzMTg2LDAuMDI3ODM4IC0xLjU0NzUzOSwtMC42Mzg0ODIgLTEuNjE3OTYyLC0xLjQzNzMxN2MtMC4xMTQ1MTMsLTAuODM4NiAwLjU0MTMyMywtMS42NzgyNDEgMS4zODEzNjQsLTEuNzc1MDM0eiIgZmlsbD0iIzAwMDAwMCIvPgogPC9nPgo8L3N2Zz4=';
	var iconHideAP = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogPGc+CiAgPHRpdGxlPkxheWVyIDE8L3RpdGxlPgogIDxwYXRoIGlkPSJzdmdfMSIgZD0ibS02MTIsMzIwbDAsOTZsOTYsMGwwLC05NmwtOTYsMHptODMsODNsLTcwLDBsMCwtNzBsNzAsMGwwLDcweiIvPgogIDxwYXRoIGlkPSJzdmdfMiIgZD0ibTcuMzQwNDQ2LDIuNzU5NjM4YzIuODczNTkyLC0wLjIwNjk1MSA1LjgxMzcxNiwwLjg2ODE4NSA3Ljg2NDYyNCwyLjg5MzEyNGMwLjI2ODczLDAuMjc2NjQgMC4yMzM2ODYsMC43NjA1NzEgLTAuMDQ5ODIzLDEuMDE0MDkyYy0wLjI2MDM5MiwwLjMwNjk2NCAtMC43ODE4NDcsMC4zMTIzOSAtMS4wNTA1NzksMC4wMTMzNjljLTEuNzU0NDYsLTEuNjg5MDYzIC00LjIzMTU2MywtMi42MDI0MDkgLTYuNjYzODQzLC0yLjQyMDc1M2MtMi4wMjA2MTUsMC4xMjk5OTcgLTMuOTc4MDQxLDEuMDAwMzU5IC01LjQ0NDI3MiwyLjM5NDM4NmMtMC4xMzAzOTUsMC4xMzMyNzYgLTAuMjk2OTA2LDAuMjQyNzAxIC0wLjQ4ODY1MSwwLjI1MjA4MWMtMC40ODAzMTEsMC4wNTYzMjMgLTAuOTI0NTA2LC0wLjQ0NTY2NCAtMC44MjA4NDYsLTAuOTE1NDkyYzAuMDI5MjQ5LC0wLjE2ODY1OCAwLjEzNzU2OSwtMC4zMDkxMzkgMC4yNjE0MzQsLTAuNDIxNDc2YzEuNzE2NTY0LC0xLjY0MzU2NCA0LjAyMTAyNCwtMi42NTI5NjcgNi4zOTE5NTYsLTIuODA5MzMxeiIgZmlsbD0iIzdmN2Y3ZiIvPgogIDxwYXRoIHN0cm9rZT0ibnVsbCIgaWQ9InN2Z18zIiBkPSJtNy4yNjkzMTYsNS41Nzc2NDVjMi4yMDE1MzgsLTAuMjM5NDUxIDQuNDg3NiwwLjU3MjA0NiA2LjA0NTUzMywyLjE0NTE4NmMwLjI0MzQwNCwwLjI3ODA4MiAwLjIxMzA4NCwwLjczMjc5MyAtMC4wNTczOTQsMC45ODI2OThjLTAuMjQ2Njg3LDAuMzAxOTAzIC0wLjc0Mzk1MywwLjMzNTgxMiAtMS4wMjM1MDcsMC4wNjIwNTRjLTAuOTk3NDc3LC0wLjk4MzM3NSAtMi4zNDYwMDQsLTEuNjA3Nzg0IC0zLjc0NDMyNCwtMS43MTAwMDRjLTEuNjk4MTM2LC0wLjE0MDg0OSAtMy40MzMwNjYsMC41MDM0MjkgLTQuNjQyMTg2LDEuNjk5OTE4Yy0wLjI3ODgxNiwwLjI5NDY5OSAtMC43OTgxNTgsMC4yNjExNTcgLTEuMDQ5MTA2LC0wLjA1MjM2NmMtMC4yNzA1MDksLTAuMjU1MzAyIC0wLjI5Mjg5MSwtMC43MjIzMDggLTAuMDMzMjM1LC0wLjk5Mjc4N2MxLjE5ODI5NywtMS4xOTg5NyAyLjgxODc0MywtMS45NjE3MTcgNC41MDQyMTksLTIuMTM0Njk4eiIgZmlsbD0iIzdmN2Y3ZiIvPgogIDxwYXRoIHN0cm9rZT0ibnVsbCIgaWQ9InN2Z180IiBkPSJtNy41OTQ3MDYsOC4zNTgwOTRjMS4zODkzMDMsLTAuMTM3OTM4IDIuODI1NjEsMC4zOTQwMzcgMy43OTIzNjYsMS40MDAxODhjMC4yNjQ3MTQsMC4yNzU1MzggMC4yMzQwNTQsMC43NDk3NDggLTAuMDQ0NzkzLDEuMDA0NzEzYy0wLjI1MzE1NiwwLjMwNTU1MiAtMC43NjA1NzEsMC4zMjYxNTYgLTEuMDM1NzQsMC4wMzk3MzRjLTAuNTQ0OTQzLC0wLjU1OTM4MSAtMS4yOTk3ODEsLTAuOTEyOTc3IC0yLjA4MTI5MiwtMC45NTU1OTRjLTAuODg2OTQ3LC0wLjA2MzIyIC0xLjc4NDQxMiwwLjI4NzEyNSAtMi40MTQyNTEsMC45MTA0MzNjLTAuMTU0OTIyLDAuMTc0MTE2IC0wLjM4NDk5LDAuMjgwOTk0IC0wLjYyMDQ1NiwwLjI1MzIxN2MtMC41NDY3NTEsLTAuMDM4MzIzIC0wLjkyNjMxNSwtMC43NjgyMDMgLTAuNTQ5NjYzLC0xLjIwNjI2N2MwLjc2MDU3LC0wLjgyNDg2MiAxLjg0MDc2NiwtMS4zMzU4OTUgMi45NTM4MjksLTEuNDQ2NDI0eiIgZmlsbD0iIzdmN2Y3ZiIvPgogIDxwYXRoIHN0cm9rZT0ibnVsbCIgaWQ9InN2Z181IiBkPSJtNy44MDg4NjIsMTAuOTU0MzcxYzAuODk1Mjg3LC0wLjE1MDIyOSAxLjgwMzkxMiwwLjU4OTA2NSAxLjgzMjgyNCwxLjQ5NjkyMmMwLjA4MzA1NiwwLjg5MDIyNyAtMC43MDI4MDcsMS43MzQ5OSAtMS41OTYyMjYsMS43MTU0MjljLTAuODAzMTg2LDAuMDI3ODM4IC0xLjU0NzUzOSwtMC42Mzg0ODIgLTEuNjE3OTYyLC0xLjQzNzMxN2MtMC4xMTQ1MTMsLTAuODM4NiAwLjU0MTMyMywtMS42NzgyNDEgMS4zODEzNjQsLTEuNzc1MDM0eiIgZmlsbD0iIzdmN2Y3ZiIvPgogIDxwYXRoIGZpbHRlcj0idXJsKCNzdmdfN19ibHVyKSIgc3Ryb2tlPSJudWxsIiBpZD0ic3ZnXzciIGQ9Im0zLjQzNDc5OSwxMi4xODU1OThsOS43NzAzMDgsLTkuNzcwMzA5bDAuNzcwNzc2LDAuNzcwNzc2bC05Ljc3MDMwNyw5Ljc3MDMwOGwtMC43NzA3NzcsLTAuNzcwNzc1eiIgc3Ryb2tlLWxpbmVjYXA9Im51bGwiIHN0cm9rZS1saW5lam9pbj0ibnVsbCIgc3Ryb2tlLWRhc2hhcnJheT0ibnVsbCIgc3Ryb2tlLXdpZHRoPSJudWxsIiBmaWxsPSIjZTAwMjAyIi8+CiA8L2c+CiA8ZGVmcz4KICA8ZmlsdGVyIGhlaWdodD0iMjAwJSIgd2lkdGg9IjIwMCUiIHk9Ii01MCUiIHg9Ii01MCUiIGlkPSJzdmdfN19ibHVyIj4KICAgPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iMC4zIiBpbj0iU291cmNlR3JhcGhpYyIvPgogIDwvZmlsdGVyPgogPC9kZWZzPgo8L3N2Zz4=';
	var showButton = new ymaps.control.Button({
		data: {
			title: 'Скрыть/показать беспроводные точки доступа',
			image: iconShowAP
		},
		options: {
			float: 'right'
		},
		state: {
			selected: true
		}
	});
	showButton.events
		.add(
			'select',
			function () {
				myMap.geoObjects.add(remoteObjectManager);
				showButton.data.set('image', iconShowAP);
			}
		)
		.add(
			'deselect',
			function () {
				myMap.geoObjects.remove(remoteObjectManager);
				showButton.data.set('image', iconHideAP);
			}
		);
	myMap.controls.add(showButton);

	// Кнопка сохранения точек в файл
	var iconSave = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaGVpZ2h0PSIxNnB4IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxNiAxNiIgd2lkdGg9IjE2cHgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6c2tldGNoPSJodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2gvbnMiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48dGl0bGUvPjxkZWZzLz48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGlkPSJJY29ucyB3aXRoIG51bWJlcnMiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIj48ZyBmaWxsPSIjMDAwMDAwIiBpZD0iR3JvdXAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC03MjAuMDAwMDAwLCAtNDMyLjAwMDAwMCkiPjxwYXRoIGQ9Ik03MjEsNDQ2IEw3MzMsNDQ2IEw3MzMsNDQzIEw3MzUsNDQzIEw3MzUsNDQ2IEw3MzUsNDQ4IEw3MjEsNDQ4IFogTTcyMSw0NDMgTDcyMyw0NDMgTDcyMyw0NDYgTDcyMSw0NDYgWiBNNzI2LDQzMyBMNzMwLDQzMyBMNzMwLDQ0MCBMNzMyLDQ0MCBMNzI4LDQ0NSBMNzI0LDQ0MCBMNzI2LDQ0MCBaIE03MjYsNDMzIiBpZD0iUmVjdGFuZ2xlIDIxNyIvPjwvZz48L2c+PC9zdmc+';
	var saveButton = new ymaps.control.Button({
		data: {
			title: 'Сохранить отображаемые точки в файл',
			image: iconSave
		},
		options: {
			float: 'right'
		}
	});
	saveButton.events.add('click', function ()
	{
		var points = [];
		var element = document.createElement('div'); // to convert special html chars
		remoteObjectManager.objects.each(function (el)
		{
			//if (!remoteObjectManager.getObjectState(el.id).isShown) { return; }
			var lat = el.geometry.coordinates[0];
			var lon = el.geometry.coordinates[1];
			var hints = el.properties.hintContent.split('<hr>');
			for (var i = 0, l = hints.length; i < l; i++)
			{
				element.innerHTML = hints[i].split('<br>').slice(1).concat([lat, lon]).join("\t") + "\r\n";
				hints[i] = element.textContent;
				element.textContent = '';
			}
			points = points.concat(hints);
		});
		var blob = new Blob(points, {type: 'text/plain; charset=utf-8'});
		saveAs(blob, '');
	});
	myMap.controls.add(saveButton, {float: 'right', selectOnClick: false});
}
function initpage()
{
	$('.content').css('padding-left', '0px');
	$('.content').css('padding-right', '0px');
	$('.content').css('padding-top', '0px');
	$('.content').css('padding-bottom', '0px');
	ymaps.ready(initmap);	
}
</script>
</head>

<body>
<div id=map style="width: 100%; height: 100%"></div>
</body>